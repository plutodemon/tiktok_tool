# tiktok_tool

### V0.2.0 版本发布

抖音直播伴侣抓取推流码和服务器

## 使用方法

- 环境支持: 需要安装 [Npcap](https://npcap.com/#download) 以及需要支持 OpenGL 3.3
    - 若物理机不持支 OpenGL 3.3, 可以尝试使用 Mesa3D 解决方案 具体安装可自行搜索
- 程序配置
    - 若要使用**一键开播**功能 需要管理员权限运行程序 左下角状态栏会显示当前程序权限(User为普通用户权限,
      Admin为管理员权限)
    - **正则设置**：一般默认即可 官方会定期修改推流格式 如果有修改 可在Issues中反馈 后期考虑会加入更新服务器
    - 网卡设置：一般选择自己的物理网卡即可(一般带有 GbE 字样的网卡)
    - 日志设置：勾选输出到文件 设置日志级别后会在程序所在目录下生成 `log/tiktok_tool.log` 日志文件(可以手动删除该文件夹)
    - **脚本设置**：这里需要下载自动化脚本可以执行程序 可以一键下载 会保存到 `plugin` 文件夹下 名为 `auto.exe` 的文件
        - 可以自行下载 [auto.exe](https://github.com/plutodemon/py_win_auto/releases/tag/v0.1.1) 具体使用方法可参照README.md
        - 插件具体设置：一般若在程序启动时启动了直播伴侣 且页面已加载完毕 等待时间可配置为0 (默认检查间隔时间为 1s, 等待时间为
          5s, 超时时间为 20s)
    - 路径设置：这里需要配置路径 用来实现启动直播伴侣, 启动OBS, 导入OBS配置的功能
        - OBS WebSocket: 需要OBS开启 WebSocket 服务, 用来在OBS启动时可以导入配置,
          否则导入配置时需要保持OBS关闭(开启时不通过ws导入则无效)  
          这里的ip也可以配置为局域网内其余主机的ip地址, 可以导入其余主机的OBS配置
        - **恢复默认配置**：会删除当前目录下的 `config/tiktok_tool_cfg.toml` 配置文件, 恢复默认配置,
          需要重启程序生效(也可以手动删除)
    - 窗口行为：可以设置最小化到系统托盘, 关闭时最小化到系统托盘, 以及是否在启动时最小化到系统托盘
        - 最小化到系统托盘后可以通过右键菜单打开主页面, 打开直播伴侣, 打开OBS, 退出程序等功能
        - **启动时打开直播伴侣和OBS** 一般默认勾选 作为启动任务被执行
            - 如果在一键开播处才打开直播伴侣 则在获取控件时候会有较大概率找不到控件报错 导致一键开播被中断
- 开播使用流程：
    - 检查配置
    - 前置需求：打开直播伴侣 打开OBS WebSocket服务
    - 打开此程序 点击**开始抓包**按钮
    - 点击直播伴侣开始按钮 开始直播
    - 获取到推流码和服务器地址后 点击**导入OBS**按钮
    - 随后关闭直播伴侣软件而**不关闭直播间**
    - 随后即可使用OBS开始推流
- 一键开播：会按照流程执行上面的步骤 大概总耗时30秒

## 更新日志

### release-v0.2.0

- 加入自动化操作脚本 通过配置可以实现一键开播的功能
    - 一键开播需要配置全部路径以及下载自动化脚本插件
- 加入日志 可以设置日志级别 更快定位问题所在
- 新增系统托盘 可以最小化窗口而不关闭程序

---

### release-v0.1.2

- 添加了导入OBS推流配置
    - 在设置页面可以选择要更改的配置文件路径 支持自动检测
        - 默认路径为 `C:\Users\用户名\AppData\Roaming\obs-studio\basic\profiles\service.json`
    - 点击抓包后 获取到推流地址和推流码后 即可导入OBS配置中

---

### release-v0.1.1

- 添加了设置页面
    - 在设置页面可以选择监听的网卡
    - 可以修改推流码和服务器正则匹配式 如若获取不了相关信息 可以用wireShark抓包获取信息格式后 在设置界面写入与其相对应的正则表达式
    - 目前默认的正则为:
        - 服务器地址: `(rtmp://push-rtmp-[a-zA-Z0-9\-]+\.douyincdn\.com/thirdgame)`
        - 推流码: `(stream-\d+\?expire=\d+&sign=[a-f0-9]+(?:&volcSecret=[a-f0-9]+&volcTime=\d+)?)`
    - 如果修改了新的正则表达式和网卡信息 需要保存后才能生效 随后会生成名为 `tiktok_tool_cfg.toml` 的配置文件
        - 此文件为新的配置文件 会覆盖默认的配置信息 点击恢复默认配置按钮或者删除该文件即可恢复默认配置

--- 

### release-v0.1.0

- 实现了抖音直播伴侣的推流码和服务器地址抓取的基本功能
- 使用方法:
    - 打开软件 启动时会检测 [Npcap](https://npcap.com/#download) 是否安装 如果没有安装会提示安装
    - 安装成功后需要重启软件
    - 点击开始抓包按钮 之后点击直播伴侣开始直播即可
        - _**注意**_ : 一定要先点击开始抓包按钮再点击直播伴侣开始直播 否则无法获取到推流码和服务器地址